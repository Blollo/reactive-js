<!DOCTYPE html>
<html>
<head>
    <title>Final Test: [if] and [show]</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .success { background: lightgreen; padding: 15px; margin: 10px 0; }
        .info { background: lightblue; padding: 15px; margin: 10px 0; }
        .test { border: 2px solid #333; padding: 15px; margin: 20px 0; }
        button { padding: 10px 20px; font-size: 16px; margin: 5px; }
    </style>
</head>
<body>
    <h1>✅ Final Test: [if] and [show] Directives</h1>

    <div id="app">
        <!-- Test 1: Simple boolean -->
        <div class="test">
            <h3>Test 1: Simple Boolean Toggle</h3>
            <p>Value: <strong id="t1-value">false</strong></p>
            <button id="t1-btn">Toggle</button>

            <div [if]="flag1" class="success">
                ✓ [if] Element is visible!
            </div>
            <p [show]="flag1" class="info">
                ✓ [show] Element is shown!
            </p>
        </div>

        <!-- Test 2: Computed values -->
        <div class="test">
            <h3>Test 2: Computed Values (like your scenario)</h3>
            <p>AliceName: <span id="t2-alice">Alice</span></p>
            <p>BobName: <span id="t2-bob">Bob</span></p>
            <button id="t2-btn">Change Users</button>

            <h4 [if]="aliceName === 'Alice' && bobName === 'Bob'" class="success">
                ✓ Condition TRUE: Alice AND Bob
            </h4>

            <div [if]="aliceName !== 'Alice'" class="info">
                ✓ Alice name changed to: {aliceName}
            </div>

            <p [show]="bobName !== 'Bob'" class="info">
                ✓ Bob name changed to: {bobName}
            </p>
        </div>

        <!-- Test 3: Multiple rapid changes -->
        <div class="test">
            <h3>Test 3: Rapid Changes (batching test)</h3>
            <p>Counter: <span id="t3-counter">0</span></p>
            <button id="t3-btn">Toggle 10x Rapidly</button>

            <div [if]="flag3" class="success">
                ✓ Flag is ON
            </div>
        </div>

        <!-- Test 4: Nested conditions -->
        <div class="test">
            <h3>Test 4: Nested [if] Elements</h3>
            <button id="t4-btn">Toggle Outer</button>

            <div [if]="outer" class="success">
                ✓ Outer is visible
                <div [if]="inner" class="info">
                    ✓ Inner is visible too!
                </div>
                <button id="t4-inner-btn">Toggle Inner</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { ref, computed, scanBindings } from '../reactive.js';

        // Test 1
        const flag1 = ref(false);

        // Test 2
        const users = ref([
            { name: 'Alice', age: 25 },
            { name: 'Bob', age: 30 }
        ]);
        const aliceName = computed(() => users.value[0].name);
        const bobName = computed(() => users.value[1].name);

        // Test 3
        const flag3 = ref(false);
        let toggleCount = 0;

        // Test 4
        const outer = ref(false);
        const inner = ref(false);

        const store = {
            flag1,
            users,
            aliceName,
            bobName,
            flag3,
            outer,
            inner
        };

        // Initialize
        scanBindings(document.getElementById('app'), store);

        // Test 1
        document.getElementById('t1-btn').addEventListener('click', () => {
            flag1.value = !flag1.value;
            document.getElementById('t1-value').textContent = flag1.value;
            console.log('Test 1: Toggled to', flag1.value);
        });

        // Test 2
        document.getElementById('t2-btn').addEventListener('click', () => {
            console.log('Test 2: Before', { alice: aliceName.value, bob: bobName.value });

            users.value = [
                { name: 'Charlie', age: 35 },
                { name: 'Diana', age: 28 }
            ];

            setTimeout(() => {
                console.log('Test 2: After', { alice: aliceName.value, bob: bobName.value });
                document.getElementById('t2-alice').textContent = aliceName.value;
                document.getElementById('t2-bob').textContent = bobName.value;
            }, 50);
        });

        // Test 3
        document.getElementById('t3-btn').addEventListener('click', () => {
            console.log('Test 3: Toggling 10 times rapidly');
            for (let i = 0; i < 10; i++) {
                flag3.value = !flag3.value;
            }
            toggleCount += 10;
            document.getElementById('t3-counter').textContent = toggleCount;
            console.log('Test 3: Final value', flag3.value);
        });

        // Test 4
        document.getElementById('t4-btn').addEventListener('click', () => {
            outer.value = !outer.value;
            console.log('Test 4: Toggled outer to', outer.value);
        });

        document.getElementById('t4-inner-btn').addEventListener('click', () => {
            inner.value = !inner.value;
            console.log('Test 4: Toggled inner to', inner.value);
        });

        console.log('✅ App initialized - all tests ready!');
    </script>
</body>
</html>
