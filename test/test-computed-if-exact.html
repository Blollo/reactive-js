<!DOCTYPE html>
<html>
<head>
    <title>Exact Test: Computed with [if]</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .visible { background: lightgreen; padding: 10px; margin: 10px 0; }
        .test { border: 2px solid #ccc; padding: 10px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>Testing Computed Values with [if] and [show]</h1>

    <div id="app">
        <div class="test">
            <h3>Test: Computed values with [if]</h3>
            <p>aliceName: <span id="alice-display">?</span></p>
            <p>bobName: <span id="bob-display">?</span></p>
            <p>Condition result: <span id="condition-result">?</span></p>
            <button @click="onClick" id="change-btn">Change Users (after 2 sec)</button>

            <h3 [if]="aliceName === 'Alice' && bobName === 'Bob'">
                âœ“ This should show when Alice and Bob
            </h3>

            <div [if]="aliceName !== 'Alice'">
                <p class="visible">Alice name changed! (using [if])</p>
            </div>

            <div [if]="aliceName !== 'Alice'">
                <p class="visible">Alice name changed! 1(using [if])</p>
            </div>

            <p [show]="aliceName !== 'Alice'" class="visible">
                Alice name changed! (using [show])
            </p>
        </div>

        <div class="test">
            <h3>Debug Info</h3>
            <pre id="debug-info"></pre>
        </div>
    </div>

    <script type="module">
        import { ref, computed, scanBindings } from '../reactive.js';

        const users = ref([
            { name: 'Alice', age: 25 },
            { name: 'Bob', age: 30 },
            { name: 'Charlie', age: 35 }
        ]);

        const aliceName = computed(() => users.value[0].name);
        const bobName = computed(() => users.value[1].name);
        
        const onClick = () => {
            console.log('Button clicked - will change users in 2 seconds');

            setTimeout(() => {
                console.log('Changing users NOW');
                console.log('Before:', { alice: aliceName.value, bob: bobName.value });

                users.value = [
                    { name: 'ASD', age: 25 },
                    { name: 'QWE', age: 30 },
                    { name: '123', age: 35 }
                ];

                // Force a check
                setTimeout(() => {
                    console.log('After:', { alice: aliceName.value, bob: bobName.value });
                    updateDisplays();
                }, 100);
            }, 2000);
        };

        const store = {
            users,
            aliceName,
            bobName,
            onClick,
        };


        // Update displays
        function updateDisplays() {
            document.getElementById('alice-display').textContent = aliceName.value;
            document.getElementById('bob-display').textContent = bobName.value;
            const condition = aliceName.value === 'Alice' && bobName.value === 'Bob';
            document.getElementById('condition-result').textContent = condition;

            const debugInfo = `
aliceName: "${aliceName.value}"
bobName: "${bobName.value}"
Condition (aliceName === 'Alice' && bobName === 'Bob'): ${condition}
Not Alice (aliceName !== 'Alice'): ${aliceName.value !== 'Alice'}
Time: ${new Date().toLocaleTimeString()}
            `;
            document.getElementById('debug-info').textContent = debugInfo;
        }

        // Initial scan
        scanBindings(document.getElementById('app'), store);

        // Update displays initially and on changes
        updateDisplays();

        // Watch for changes
        let updateCount = 0;
        setInterval(() => {
            updateDisplays();
        }, 100);

        console.log('App initialized');
        console.log('Initial values:', { alice: aliceName.value, bob: bobName.value });
    </script>
</body>
</html>
